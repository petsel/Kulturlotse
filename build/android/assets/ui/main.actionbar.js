var ActionBar=require("com.alcoapps.actionbarextras"),Moment=require("vendor/moment"),day=Moment().format("YYYY-MM-DD");module.exports=function(e){Ti.App.addEventListener("day",function(e){day=e.day});var a=e.source.event,n=e.source.getActivity();ActionBar.setFont("PT Serif Bold"),ActionBar.subtitleColor="#444";var r=require("vendor/gms.test")();n&&(n.onCreateOptionsMenu=function(e){e.menu.clear(),r&&e.menu.add({title:"Karte",itemId:"3",icon:Ti.App.Android.R.drawable.ic_action_hhmap,showAsAction:Ti.Android.SHOW_AS_ACTION_IF_ROOM}).addEventListener("click",function(){require("ui/map.window")({day:day}).open()}),e.menu.add({title:"Filter",itemId:"5",icon:Ti.App.Android.R.drawable.ic_action_filter,showAsAction:Ti.Android.SHOW_AS_ACTION_IF_ROOM}).addEventListener("click",function(){var e=Ti.App.Properties.getString("categories").split(","),a=Ti.App.Properties.getList("selectedindexes",[0,1,2,3,4,5,6]),n=(Ti.App.Properties.getList("selectedcategories",[1,2,3,4,5,6,7]),[]);a.forEach(function(a){n.push(e[a])});var r=require("yy.tidialogs").createMultiPicker({title:"Kategoriefilter",options:e,selected:n,okButtonTitle:"Mach' es!"});r.addEventListener("click",function(e){Ti.App.Properties.setList("selectedindexes",e.indexes),Ti.App.Properties.setList("selectedcategories",e.indexes.map(function(e){return e+1})),Ti.App.fireEvent("categorieschanged")}),r.show()}),a&&a.locationId&&r&&(e.menu.clear(),e.menu.add({title:"Wo finde ich … ?",itemId:"1",showAsAction:Ti.Android.SHOW_AS_ACTION_NEVER}).addEventListener("click",function(){require("ui/map.window")(a).open()}),e.menu.add({title:"Wie finde ich dorthin?",itemId:"2",showAsAction:Ti.Android.SHOW_AS_ACTION_NEVER}).addEventListener("click",function(){require("ui/routing.window")(a).open()}),a.locationId&&"0"!=a.locationId&&e.menu.add({title:"nächste Veranstaltungen",itemId:"2",showAsAction:Ti.Android.SHOW_AS_ACTION_NEVER}).addEventListener("click",function(){require("ui/nextevents.window")(a).open()})),n.actionBar.displayHomeAsUp=a?!0:!1},n&&n.invalidateOptionsMenu(),n.actionBar.onHomeIconItemSelected=function(){e.source.close()},ActionBar.setTitle("Kulturlotse"),ActionBar.setSubtitle(a?a.locationName:"Heute, "+require("vendor/moment")().format("DD.MM.YYYY")))};