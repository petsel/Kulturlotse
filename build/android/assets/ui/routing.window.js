var ActionBar=require("com.alcoapps.actionbarextras");module.exports=function(e){var a=new(require("adapter/events")),n=require("model/stadtrad").map(function(e){return require("ti.map").createAnnotation({latitude:e.lat,longitude:e.lng,image:"/images/rad.png",subtitle:e.hal2option.bikelist.length+" Räder",title:e.hal2option.tooltip.replace(/&nbsp;/g," ").replace(/^'/,"").replace(/'$/,"").replace(/^[\d]+/,"")})}),r=a.getLocationById(e.locationId),i=[],t=Ti.UI.createWindow({fullscreen:!0,event:JSON.stringify(e)}),c=new(require("vendor/georoute"));c.addEventListener("position",function(a){r.latitude&&r.longitude?r.latitude+","+r.longitude:e.locationStreet+","+e.locationPlz+","+e.locationCity;c.getRoute(a.coords,e.locationCity+","+e.locationStreet),t.addEventListener("modechanged",function(r){r.stadtrad?d.addAnnotations(n):d.removeAnnotations(n),c.getRoute(a.coords,e.locationCity+","+e.locationStreet)})}),c.getLocation();var o=require("vendor/gms.test")();if(o){var d=require("ti.map").createView({region:{latitude:53.5,longitude:10,latitudeDelta:.5,longitudeDelta:.5},animated:!0,traffic:!1,enableZoomControls:!1,userLocation:!1,mapType:require("ti.map").NORMAL_TYPE,height:"50%",top:0});t.add(d),c.addEventListener("route",function(a){var n=a.route.legs[0];ActionBar.setSubtitle(Ti.App.Properties.getString("MODESTRING","Fußmarsch")+" ("+n.duration.text+")");var r=a.route.bounds,t={latitude:(Math.max(r.southwest.lat,r.northeast.lat)+Math.min(r.southwest.lat,r.northeast.lat))/2,longitude:(Math.max(r.southwest.lng,r.northeast.lng)+Math.min(r.southwest.lng,r.northeast.lng))/2,latitudeDelta:1.6*(Math.max(r.southwest.lat,r.northeast.lat)-Math.min(r.southwest.lat,r.northeast.lat)),longitudeDelta:1.6*(Math.max(r.southwest.lng,r.northeast.lng)-Math.min(r.southwest.lng,r.northeast.lng))};for(d.setRegion(t);route=i.pop();)d.removeRoute(route);i=[require("ti.map").createRoute({points:require("vendor/decodePolyline")(a.route.overview_polyline.points),width:8*Ti.Platform.displayCaps.logicalDensityFactor,opacity:.6,color:"orange"}),require("ti.map").createRoute({points:require("vendor/decodePolyline")(a.route.overview_polyline.points),width:1*Ti.Platform.displayCaps.logicalDensityFactor,opacity:1,color:"#000"})],i.forEach(function(e){d.addRoute(e)}),d.addAnnotation(require("ti.map").createAnnotation({image:"/images/house.png",latitude:n.start_location.lat,longitude:n.start_location.lng})),d.addAnnotation(require("ti.map").createAnnotation({image:"/images/map"+e.categoryId+".png",latitude:n.end_location.lat,longitude:n.end_location.lng}))})}var m=Ti.UI.createTableView({bottom:0,height:o?"50%":Ti.UI.FILL});return t.add(m),c.addEventListener("route",function(e){var a=e.route.legs[0],n=[],r=Ti.UI.createTableViewRow();r.add(Ti.UI.createLabel({html:a.start_address,left:10,top:5,bottom:5,color:"orange",width:Ti.UI.FILL,textAlign:"left",font:{fontFamily:"PT Serif Bold",fontSize:22}})),n[0]=r,a.steps.forEach(function(e){var a=Ti.UI.createTableViewRow();a.add(Ti.UI.createLabel({html:e.html_instructions,left:90,top:5,bottom:5,width:Ti.UI.FILL,textAlign:"left",font:{fontFamily:"DroidSans",fontSize:16}})),a.add(Ti.UI.createLabel({text:e.distance.text,left:5,top:0,color:"#888",width:Ti.UI.FILL,textAlign:"left",font:{fontFamily:"DroidSans",fontSize:22,fontWeight:"bold"}})),n.push(a)});var i=Ti.UI.createTableViewRow();i.add(Ti.UI.createLabel({html:a.end_address,left:10,top:5,bottom:5,color:"orange",width:Ti.UI.FILL,textAlign:"left",font:{fontFamily:"PT Serif Bold",fontSize:22}})),n.push(i),m.setData(n)}),d.addEventListener("complete",function(){}),t.addEventListener("open",require("ui/routing.actionbar")),t};