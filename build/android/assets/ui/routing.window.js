var ActionBar=require("com.alcoapps.actionbarextras");module.exports=function(e){var a=new(require("adapter/events")),n=a.getLocationById(e.locationId),r=[],i=Ti.UI.createWindow({fullscreen:!0,event:JSON.stringify(e)}),t=new(require("vendor/georoute"));t.addEventListener("position",function(a){n.latitude&&n.longitude?n.latitude+","+n.longitude:e.locationStreet+","+e.locationPlz+","+e.locationCity;t.getRoute(a.coords,e.locationCity+","+e.locationStreet),i.addEventListener("modechanged",function(){t.getRoute(a.coords,e.locationCity+","+e.locationStreet)})}),t.getLocation();var o=require("vendor/gms.test")();if(o){var c=require("ti.map").createView({region:{latitude:53.5,longitude:10,latitudeDelta:.5,longitudeDelta:.5},animated:!0,traffic:!1,enableZoomControls:!1,userLocation:!1,mapType:require("ti.map").NORMAL_TYPE,height:"50%",top:0});i.add(c),t.addEventListener("route",function(a){var n=a.route.legs[0];ActionBar.setSubtitle(Ti.App.Properties.getString("MODESTRING","Fu√ümarsch")+" ("+n.duration.text+")");var i=a.route.bounds,t={latitude:(Math.max(i.southwest.lat,i.northeast.lat)+Math.min(i.southwest.lat,i.northeast.lat))/2,longitude:(Math.max(i.southwest.lng,i.northeast.lng)+Math.min(i.southwest.lng,i.northeast.lng))/2,latitudeDelta:1.6*(Math.max(i.southwest.lat,i.northeast.lat)-Math.min(i.southwest.lat,i.northeast.lat)),longitudeDelta:1.6*(Math.max(i.southwest.lng,i.northeast.lng)-Math.min(i.southwest.lng,i.northeast.lng))};for(c.setRegion(t);route=r.pop();)c.removeRoute(route);r=[require("ti.map").createRoute({points:require("vendor/decodePolyline")(a.route.overview_polyline.points),width:8*Ti.Platform.displayCaps.logicalDensityFactor,opacity:.6,color:"orange"}),require("ti.map").createRoute({points:require("vendor/decodePolyline")(a.route.overview_polyline.points),width:1*Ti.Platform.displayCaps.logicalDensityFactor,opacity:1,color:"#000"})],r.forEach(function(e){c.addRoute(e)}),c.addAnnotation(require("ti.map").createAnnotation({image:"/images/house.png",latitude:n.start_location.lat,longitude:n.start_location.lng})),c.addAnnotation(require("ti.map").createAnnotation({image:"/images/map"+e.categoryId+".png",latitude:n.end_location.lat,longitude:n.end_location.lng}))})}var d=Ti.UI.createTableView({bottom:0,height:o?"50%":Ti.UI.FILL});return i.add(d),t.addEventListener("route",function(e){var a=e.route.legs[0],n=[],r=Ti.UI.createTableViewRow();r.add(Ti.UI.createLabel({html:a.start_address,left:10,top:5,bottom:5,color:"orange",width:Ti.UI.FILL,textAlign:"left",font:{fontFamily:"PT Serif Bold",fontSize:22}})),n[0]=r,a.steps.forEach(function(e){var a=Ti.UI.createTableViewRow();a.add(Ti.UI.createLabel({html:e.html_instructions,left:90,top:5,bottom:5,width:Ti.UI.FILL,textAlign:"left",font:{fontFamily:"DroidSans",fontSize:16}})),a.add(Ti.UI.createLabel({text:e.distance.text,left:5,top:0,color:"#888",width:Ti.UI.FILL,textAlign:"left",font:{fontFamily:"DroidSans",fontSize:22,fontWeight:"bold"}})),n.push(a)});var i=Ti.UI.createTableViewRow();i.add(Ti.UI.createLabel({html:a.end_address,left:10,top:5,bottom:5,color:"orange",width:Ti.UI.FILL,textAlign:"left",font:{fontFamily:"PT Serif Bold",fontSize:22}})),n.push(i),d.setData(n)}),c.addEventListener("complete",function(){}),i.addEventListener("open",require("ui/routing.actionbar")),i};